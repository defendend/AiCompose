#!/bin/bash
# ðŸŽ¥ Ð’Ð¸Ð´ÐµÐ¾-Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ RAG ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
# ÐŸÑ€ÑÐ¼Ñ‹Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ñ‹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· /api/tools/execute

set -e

SERVER="http://89.169.190.22"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð°
echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°..."
curl -sf "$SERVER/api/health" > /dev/null || { echo "âŒ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½!"; exit 1; }
echo "âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ðŸŽ¥ RAG System Demo - AiCompose"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
echo "ðŸ“ Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ"
echo ""

ssh -l defendend 89.169.190.22 "mkdir -p /tmp/demo_docs && cat > /tmp/demo_docs/docker.md << 'EOF'
# Docker Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹

Docker Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð°Ð³ÐµÐ½Ñ‚Ñƒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°Ð¼Ð¸:
- docker_run - Ð·Ð°Ð¿ÑƒÑÐº ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð² (nginx, postgres, redis)
- docker_exec - Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
- docker_logs - Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
- docker_stop - Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
- docker_ps - ÑÐ¿Ð¸ÑÐ¾Ðº Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð½Ñ‹Ñ… ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²

ÐÐ³ÐµÐ½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ nginx Ð½Ð° Ð»ÑŽÐ±Ð¾Ð¼ Ð¿Ð¾Ñ€Ñ‚Ñƒ Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÐµÐ³Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ.
EOF
cat > /tmp/demo_docs/rag.md << 'EOF'
# RAG Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð°

RAG (Retrieval-Augmented Generation) Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð°Ð³ÐµÐ½Ñ‚Ñƒ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸:
- Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ Ñ€Ð°Ð·Ð±Ð¸Ð²ÐºÐ¾Ð¹ Ð½Ð° Ñ‡Ð°Ð½ÐºÐ¸ Ð¿Ð¾ 500 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²
- Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ TF-IDF ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¾Ð² (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾, Ð±ÐµÐ· Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… API)
- Ð¡ÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾ÑÐ¸Ð½ÑƒÑÐ½Ð¾Ð¼Ñƒ ÑÑ…Ð¾Ð´ÑÑ‚Ð²Ñƒ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¾Ð²
- Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ° Ð² JSON Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ

ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹: md, txt, kt, java, js, py, ts.
EOF
cat > /tmp/demo_docs/history.md << 'EOF'
# Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹

ÐŸÑ€Ð¾Ñ„ÐµÑÑÐ¾Ñ€ ÐÑ€Ñ…Ð¸Ð²Ð°Ñ€Ð¸ÑƒÑ Ð·Ð½Ð°ÐµÑ‚ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ:
- get_historical_events - ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ Ð³Ð¾Ð´Ð°Ð¼ (1945, 1961, 1991)
- get_historical_figure - Ð±Ð¸Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ð¸ Ð²ÐµÐ»Ð¸ÐºÐ¸Ñ… Ð»ÑŽÐ´ÐµÐ¹ (ÐÐ°Ð¿Ð¾Ð»ÐµÐ¾Ð½, Ð¦ÐµÐ·Ð°Ñ€ÑŒ, ÐšÐ»ÐµÐ¾Ð¿Ð°Ñ‚Ñ€Ð°)
- compare_eras - ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… ÑÐ¿Ð¾Ñ… (Ð°Ð½Ñ‚Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ, ÑÑ€ÐµÐ´Ð½ÐµÐ²ÐµÐºÐ¾Ð²ÑŒÐµ)
- get_historical_quote - Ñ†Ð¸Ñ‚Ð°Ñ‚Ñ‹ Ð²ÐµÐ»Ð¸ÐºÐ¸Ñ… Ð»ÑŽÐ´ÐµÐ¹

ÐÐ³ÐµÐ½Ñ‚ Ñ€Ð°ÑÑÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¶Ð¸Ð²Ð¾, Ñ Ð´ÐµÑ‚Ð°Ð»ÑÐ¼Ð¸ Ð¸ Ð°Ð½ÐµÐºÐ´Ð¾Ñ‚Ð°Ð¼Ð¸ Ð¸Ð· Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸.
EOF
ls -lh /tmp/demo_docs/
"

echo "âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ 3 Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°"
echo ""

# Ð¨Ð°Ð³ 2: Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
echo "ðŸ“š Ð¨Ð°Ð³ 2: Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²"
echo ""

curl -s -X POST "$SERVER/api/tools/execute" \
  -H 'Content-Type: application/json' \
  -d '{
    "tool": "rag_index_documents",
    "arguments": "{\"path\": \"/tmp/demo_docs\", \"extensions\": \"md\"}"
  }' | jq -r '.result'

echo ""
echo "---"
echo ""

sleep 2

# Ð¨Ð°Ð³ 3: Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± Ð¸Ð½Ð´ÐµÐºÑÐµ
echo "ðŸ“Š Ð¨Ð°Ð³ 3: Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± Ð¸Ð½Ð´ÐµÐºÑÐµ"
echo ""

curl -s -X POST "$SERVER/api/tools/execute" \
  -H 'Content-Type: application/json' \
  -d '{
    "tool": "rag_index_info",
    "arguments": "{}"
  }' | jq -r '.result'

echo ""
echo "---"
echo ""

sleep 2

# Ð¨Ð°Ð³ 4: ÐŸÐ¾Ð¸ÑÐº Ð¿Ñ€Ð¾ Docker
echo "ðŸ” Ð¨Ð°Ð³ 4: ÐŸÐ¾Ð¸ÑÐº Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾ Docker"
echo ""

curl -s -X POST "$SERVER/api/tools/execute" \
  -H 'Content-Type: application/json' \
  -d '{
    "tool": "rag_search",
    "arguments": "{\"query\": \"Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹\", \"top_k\": 2}"
  }' | jq -r '.result'

echo ""
echo "---"
echo ""

sleep 2

# Ð¨Ð°Ð³ 5: ÐŸÐ¾Ð¸ÑÐº Ð¿Ñ€Ð¾ RAG
echo "ðŸ” Ð¨Ð°Ð³ 5: ÐŸÐ¾Ð¸ÑÐº Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾ RAG ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¸"
echo ""

curl -s -X POST "$SERVER/api/tools/execute" \
  -H 'Content-Type: application/json' \
  -d '{
    "tool": "rag_search",
    "arguments": "{\"query\": \"ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¸ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº\", \"top_k\": 1}"
  }' | jq -r '.result'

echo ""
echo "---"
echo ""

sleep 2

# Ð¨Ð°Ð³ 6: ÐŸÐ¾Ð¸ÑÐº Ð¿Ñ€Ð¾ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
echo "ðŸ” Ð¨Ð°Ð³ 6: ÐŸÐ¾Ð¸ÑÐº Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹"
echo ""

curl -s -X POST "$SERVER/api/tools/execute" \
  -H 'Content-Type: application/json' \
  -d '{
    "tool": "rag_search",
    "arguments": "{\"query\": \"Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð²ÐµÐ»Ð¸ÐºÐ¸Ðµ Ð»ÑŽÐ´Ð¸\", \"top_k\": 1}"
  }' | jq -r '.result'

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°
echo "ðŸ§¹ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
ssh -l defendend 89.169.190.22 "rm -rf /tmp/demo_docs"
echo "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾"
