package org.example.tools.historical

import kotlinx.serialization.json.Json
import kotlinx.serialization.json.contentOrNull
import kotlinx.serialization.json.jsonObject
import kotlinx.serialization.json.jsonPrimitive
import org.example.tools.annotations.Param
import org.example.tools.annotations.Tool
import org.example.tools.core.AnnotatedAgentTool

/**
 * Инструмент для получения информации об исторических личностях.
 */
@Tool(
    name = "get_historical_figure",
    description = "Получает краткую биографию известной исторической личности"
)
@Param(
    name = "name",
    description = "Имя исторической личности (например: Наполеон, Цезарь, Пётр, Клеопатра, Александр, Леонардо)",
    type = "string",
    required = true
)
object HistoricalFigureTool : AnnotatedAgentTool() {

    private val figures = mapOf(
        "наполеон" to """
            Наполеон Бонапарт (1769-1821)
            Французский император и полководец.
            • Родился на Корсике
            • Пришёл к власти после Французской революции
            • Провёл успешные военные кампании по всей Европе
            • Ввёл Кодекс Наполеона — основу современного гражданского права
            • Потерпел поражение в России (1812) и при Ватерлоо (1815)
            • Умер в ссылке на острове Святой Елены
        """.trimIndent(),
        "цезарь" to """
            Гай Юлий Цезарь (100-44 до н.э.)
            Римский полководец, политик и диктатор.
            • Завоевал Галлию (современная Франция)
            • Перешёл Рубикон, начав гражданскую войну
            • Стал пожизненным диктатором Рима
            • Провёл календарную реформу (юлианский календарь)
            • Убит заговорщиками в мартовские иды
            • Его имя стало титулом — «цезарь», «кайзер», «царь»
        """.trimIndent(),
        "пётр" to """
            Пётр I Великий (1672-1725)
            Русский царь и первый император России.
            • Провёл масштабные реформы, модернизировав Россию
            • Основал Санкт-Петербург (1703)
            • Создал русский флот
            • Победил шведов в Северной войне (Полтавская битва, 1709)
            • Ввёл новое летоисчисление и европейскую одежду
            • Прорубил «окно в Европу»
        """.trimIndent(),
        "клеопатра" to """
            Клеопатра VII (69-30 до н.э.)
            Последняя царица Древнего Египта.
            • Последняя из династии Птолемеев
            • Была возлюбленной Юлия Цезаря и Марка Антония
            • Владела несколькими языками, включая египетский
            • Умная правительница и искусный дипломат
            • После поражения от Октавиана покончила с собой
            • С её смертью Египет стал римской провинцией
        """.trimIndent(),
        "александр" to """
            Александр Македонский (356-323 до н.э.)
            Царь Македонии, величайший полководец древности.
            • Ученик философа Аристотеля
            • Создал огромную империю от Греции до Индии
            • Разбил Персидскую империю Дария III
            • Основал более 70 городов, включая Александрию
            • Не проиграл ни одного сражения
            • Умер в 32 года, возможно от лихорадки
        """.trimIndent(),
        "леонардо" to """
            Леонардо да Винчи (1452-1519)
            Итальянский художник, учёный и изобретатель эпохи Возрождения.
            • Автор «Моны Лизы» и «Тайной вечери»
            • Анатом, инженер, архитектор, музыкант
            • Проектировал летательные аппараты и танки
            • Вёл знаменитые зеркальные записи
            • Идеальный «человек Возрождения» (homo universalis)
            • Работал при дворах Милана, Рима и Франции
        """.trimIndent()
    )

    override suspend fun execute(arguments: String): String {
        return try {
            val json = Json.parseToJsonElement(arguments).jsonObject
            val name = json["name"]?.jsonPrimitive?.contentOrNull?.lowercase()
                ?: return "Ошибка: не указано имя"

            val figure = figures.entries.find { name.contains(it.key) }?.value
            figure ?: "Информация о '$name' не найдена в базе. " +
                "Доступны: Наполеон, Цезарь, Пётр I, Клеопатра, Александр Македонский, Леонардо да Винчи."
        } catch (e: Exception) {
            "Ошибка: ${e.message}"
        }
    }
}
